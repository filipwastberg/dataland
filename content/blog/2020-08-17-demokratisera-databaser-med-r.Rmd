---
title: Demokratisera databaser med R
author: Filip Wästberg
date: '2020-08-17'
slug: demokratisera-databaser-med-r
categories:
  - databases
  - r
tags:
  - sql
  - dplyr
description: Desc
hacker_news_id: ''
lobsters_id: ''
meta_img: /images/image.jpg
---

Att jobba med databaser är en av de viktigaste uppgifterna en analytiker eller data scientist har. En tillräckligt stor organisation kan ha flera databaser med olika information och ibland med samma (om än inte alltid överensstämmande) information. Många databaser som är skräddarsydda för en organisation har inte sällan ett eget User Interface (UI) som kan vara av varierande kvalitet. Det här leder ibland till att analytiker och data scientists lägger ner mycket tid på att hoppa mellan olika UI:s för olika databaser.

## dplyr to the rescue

Det här är olyckligt, men eftersom det är så pass vanligt, har mycket tid och kraft hos R-utvecklare världen över de senaste åren gått till att göra det enklare att koppla upp sig mot databaser. I centrum för det här arbetet står ett paket som heter `dplyr`. Det är ett paket vars syfte är att göra manipulering och bearbetning av data enklare, med stark fokus på läsbarhet och användarvänlighet. Resultatet är ett intuitivt syntax som i princip vem som helst kan förstå.

Nedan utgår vi från data om irisblommon, där vi först filterar bort arter "setosa" och sedan räknar ut den genomsnittliga bladlängden per art.

```{r}
library(dplyr)
iris %>% 
  filter(Species != "setosa") %>% 
  group_by(Species) %>% 
  summarise(mean_sepal_length = mean(Sepal.Length))
```

Eftersom att data i arbetslivet ofta ligger i databaser har utvecklarna bakom `dplyr` och de största databaspaketen i R lagt ner mycket tid på att skriva översättningar från `dplyr` till olika databaser. Det här betyder att om data-settet ovan ligger i en databas kan vi använda i princip samma syntax för att bearbeta data.

Först behöver vi skapa en koppling till databasen vi använder:

```{r}

```

Objektet `iris_tbl` är nu en koppling till tabellen `iris` i databasen `con`. Det här är det enda som behövs för att kunna använda `dplyr` för att bearbeta data i databasen.

```{r}
iris %>% 
  group_by(Species) %>% 
  summarise(mean_sepal_length = mean(Sepal.Length))
```

Ovan kod exekveras alltså inte i R, som generellt körs lokalt på en server eller en dator, utan på den server där databasen ligger(vilket i det här fallet är på min egen dator). Poängen är att vi kan använda R för att exekvera databearbetningar på mycket större datamängder än vad som är möjligt direkt i R, genom att flytta komputeringen till en databas.

När vi är klara med, säg en aggregering, kan vi enkelt ta in resultatet till R och modellera eller visualisera resultatet.

```{r}
iris %>% 
  group_by(Species) %>% 
  summarise(mean_sepal_length = mean(Sepal.Length)) %>% 
  collect() %>% 
  ggplot() +
  aes(y = Species, x = mean_sepal_length, fill = Species) +
  geom_col() +
  theme(legend.position = "none") +
  theme_minimal()
```


## Vad innebär det här för en analytiker?

Det här gör att en analytiker kan arbeta sömlöst med databaser och R. Vi kan aggregera och manipulera data via databasen och sedan lyfta in det i R för att skapa statistiska modeller och AI-flöden. 

Men framför allt möjliggör `dplyr` för en analytiker att använda *ett* interface till alla databaser som finns i en organisation. Vi slipper då hoppa mellan olika databas-UI:s och bygga manuella dataflöden för olika databaser. För en analytiker är själva databearbetningen bara ett steg i analysen och om man kan flytta databearbetningen närmare ett analytiskt verktyg, som R, så kan man dels spara tid men framför allt bygga mer robusta flöden. 

/ Filip






























