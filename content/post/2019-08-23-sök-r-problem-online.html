---
title: 'Sök hjälp! För R...'
author: "Filip Wästberg"
date: "2019-08-23"
slug: sok-hjalp-for-r
categories:
- r
banner: "css/images/helpme.jpg"
---



<div id="att-soka-efter-losningar-pa-r-problem" class="section level2">
<h2>Att söka efter lösningar på R-problem</h2>
<p>Inte sällan stöter man på problem i R som man inte kan lösa genom att läsa sig till i dokumentation m.m. Det är vanligt och händer alla som lär sig R eller något annat verktyg för att göra dataanalys.</p>
<p>Det vanligaste är att man tar det felmeddelande man får och lägger in det i Google. Då brukar man oftast hamna på någon av följande hemsidor:</p>
<p>• Stackoverflow.com
• RStudio.community.com
• statmethods.net</p>
<p>Man brukar dessutom snabbt inse att man inte är den första som stöter på ett problem, men det kan ändå vara svårt att navigera bland olika potentiella lösningar. Så hur gör man då för att hitta bästa lösningen?</p>
<p>Det finns så klart inget givet svar på den frågan men jag som har programmerat i R i några år brukar ha några förhållningsregler:</p>
<ul>
<li>Leta efter svar som är enkla: ingår det massa loopar eller ser koden komplicerad ut och det är enkelt problem du ska lösa så finns det sannolikt bättre svar</li>
<li>Leta efter de senaste svaren: programmeringsspråk är i ständig utveckling och det kommer nya metoder som är bättre än de som fanns för 10 år sedan. Så är även fallet med R. R har framför allt de senaste 5-10 åren blivit otroligt mycket enklare att använda för nybörjare. Därför kan det vara en poäng att leta efter nyare svar. Det är särskilt viktigt på StackOverflow där gamla svar kan ha ett försprång tidsmässigt och därför ha fler röster.</li>
</ul>
</div>
<div id="ett-konkret-exempel" class="section level2">
<h2>Ett konkret exempel</h2>
<p>Jag tänkte ta ett konkret exempel där jag har ett dataset som jag läst in i R där vi har en faktor-kolumn för belopp som innehåller belopp skrivet som en string, typ ”1 540”. För att kunna göra beräkningar på den behöver vi göra om den till en numerisk.</p>
<pre class="r"><code>data &lt;- data.frame(belopp = factor(c(&quot;2  592&quot;, &quot;1 500&quot;, &quot;2  216&quot;, &quot;2 124&quot;, &quot;951&quot;, &quot;430&quot;, &quot;5 011&quot;)),
                   letter = sample(letters, 7, replace = T))

data</code></pre>
<pre><code>##   belopp letter
## 1 2  592      u
## 2  1 500      h
## 3 2  216      m
## 4  2 124      c
## 5    951      u
## 6    430      r
## 7  5 011      f</code></pre>
<p>Så det första jag vill göra här är att göra om den till numerisk, jag tänker att funktionen <code>as.numeric()</code> enkelt kan göra det.</p>
<pre class="r"><code>library(dplyr)</code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code>data %&gt;% 
  mutate(belopp = as.numeric(belopp))</code></pre>
<pre><code>##   belopp letter
## 1      3      u
## 2      1      h
## 3      2      m
## 4      4      c
## 5      7      u
## 6      5      r
## 7      6      f</code></pre>
<p>Men eftersom <code>belopp</code> är en faktor så tror den att vi försöka göra om kategorisk data till numerisk. Så den tar kategorinivåerna, vilket inte alls är vad vi vill.</p>
<p>Så vi behöver först göra om den till <code>character</code></p>
<pre class="r"><code>data %&gt;% 
  mutate(belopp = as.numeric(as.character(belopp)))</code></pre>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>##   belopp letter
## 1     NA      u
## 2     NA      h
## 3     NA      m
## 4     NA      c
## 5    951      u
## 6    430      r
## 7     NA      f</code></pre>
<p>Nu visar det sig att <code>as.numeric()</code> bara kan hantera tecken som är siffror, vi har ett mellanslag här som inte är en siffra, så därför ger den tillbaka <code>NA</code> med ett varningsmeddelande: <code>NAs introduced by coercion</code>.</p>
<p>Hm, okej, så det vi vill göra (och det som är exemplet) är att ta bort blankstegen i strängarna.</p>
<p>Det blir vår första googling:</p>
<pre class="r"><code>knitr::include_graphics(&quot;https://raw.githubusercontent.com/filipwastberg/dataland/master/static/img/google-whitespace.png&quot;)</code></pre>
<p><img src="https://raw.githubusercontent.com/filipwastberg/dataland/master/static/img/google-whitespace.png" /><!-- --></p>
<p>Vilket leder oss till den en fråga på StackOverflow. StackOverflow är en hemsida där programmerare kan ställa frågor som andra kan svara på.</p>
<p>Frågan vi kommer till finns här: <a href="https://stackoverflow.com/questions/34591329/remove-white-space-from-a-data-frame-column-and-add-path" class="uri">https://stackoverflow.com/questions/34591329/remove-white-space-from-a-data-frame-column-and-add-path</a></p>
<p>På StackOverflow hamnar de frågor med flest <em>Votes</em> högst upp. I det svaret som har fått flest röster föreslår personen att vi ska använda funktionen <code>gsub()</code> som är en funktion som finns “inbyggd” i R.</p>
<pre class="r"><code>data %&gt;% 
  mutate(belopp = as.numeric(as.character(gsub(&#39;\\s+&#39;, &#39;&#39;, belopp))))</code></pre>
<pre><code>##   belopp letter
## 1   2592      u
## 2   1500      h
## 3   2216      m
## 4   2124      c
## 5    951      u
## 6    430      r
## 7   5011      f</code></pre>
<p>Vad för alternativ finns?</p>
<p>Nu är det inget fel alls på det här svaret, det gör vad vi vill. Men om man i längden arbetar mycket med att manipulera text i data så brukar jag rekommendera paketet <code>stringr</code>.</p>
<p>Vi hade kunnat göra samma sak som ovan med funktionen <code>str_replace()</code>.</p>
<pre class="r"><code>library(stringr)
data %&gt;% 
  mutate(belopp = as.numeric(as.character(str_replace(belopp, &#39;\\s+&#39;, &#39;&#39;))))</code></pre>
<pre><code>##   belopp letter
## 1   2592      u
## 2   1500      h
## 3   2216      m
## 4   2124      c
## 5    951      u
## 6    430      r
## 7   5011      f</code></pre>
<p><code>stringr</code> är ett paket som är nytt relativt till <code>gsub()</code> och andra “inbyggda” funktioner i R och det är, enligt mig, enklare att använda. Därför föredrar jag det.</p>
<p>Lycka till!</p>
<p>/ Filip</p>
</div>
